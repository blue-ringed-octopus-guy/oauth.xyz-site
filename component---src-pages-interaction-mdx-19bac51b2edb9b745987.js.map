{"version":3,"sources":["webpack:///./src/pages/interaction.mdx"],"names":["MDXContent","props","layout","DefaultLayout","render","this","components","name","Layout","layoutProps","title","keywords","parentName","from","to","code","interaction_url","server_nonce","handle","value","type","language","codeString","interact_handle","user_code","url","wait","method","src","alt","didcomm","React","Component","_frontmatter"],"mappings":"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","file":"component---src-pages-interaction-mdx-19bac51b2edb9b745987.js","sourcesContent":["import React from 'react'\nimport { MDXTag } from '@mdx-js/tag'\n\n\nimport DefaultLayout from \"/Users/jricher/Projects/oauth.xyz-site/src/components/layout.js\";\nimport Code from \"../components/code\";\nimport SEO from '../components/seo';\nexport default class MDXContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.layout = DefaultLayout;\n  }\n\n  render() {\n    const {\n      components,\n      ...props\n    } = this.props;\n    return <MDXTag name=\"wrapper\" Layout={this.layout} layoutProps={props} components={components}>\n\n\n      <SEO title=\"Interaction\" keywords={['oauth', 'authorization', 'security']} />\n      <MDXTag name=\"h1\" components={components}>{`Interaction`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`During a transaction, the AS will often require interaction from a user. This user can be the same person running the client software, or it could be another party who's not necessarily available. In the transaction request, the client tells the AS how it is able to interact with the user. Several modes of interaction are defined, and a client can support multiple forms of interaction simultaneously.`}</MDXTag>\n      <MDXTag name=\"ul\" components={components}>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`The `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`redirect`}</MDXTag>{` mode is used when the client is capable of opening a browser on the same device for the user to interact with the AS, or otherwise directing the user to an arbitrary URL.`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`The `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`user_code`}</MDXTag>{` mode is used when the client cannot open a browser for the user but can communicate an out-of-band code for the user to provide to the AS.`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`The `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`didcomm`}</MDXTag>{` mode is used when the client can relay a DIDComm message to the user's Agent.`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`The `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`dodcomm_query`}</MDXTag>{` mode is used when the client can relay a query to a DIDComm Agent. `}</MDXTag>\n      </MDXTag>\n      <MDXTag name=\"p\" components={components}>{`In addition, the client can indicate how it can receive responses from the interaction request. Currently, there are two modes of getting a response:`}</MDXTag>\n      <MDXTag name=\"ul\" components={components}>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`The client can set a `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`callback`}</MDXTag>{` section including a URL that the AS can send the user back to when done interacting`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`The client can poll the AS using a transaction handle`}</MDXTag>\n      </MDXTag>\n      <MDXTag name=\"p\" components={components}>{`These can be used independently of the interaction method, but it will likely be most common to use a callback with the redirect method, polling with the device method, and in limited cases polling with the redirect method. These combinations are shown here.`}</MDXTag>\n      <MDXTag name=\"h2\" components={components}>{`Redirect with Callback`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`In redirect based interaction, the client sends the user to an interactive page at the AS. The AS then sends the user back to the client with an HTTP redirect. `}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`To use this mode, the client's transaction request includes a section that includes a URI the client can receive requests at as well as a unique state value. `}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        \"interact\": {\n          \"redirect\": true,\n          \"callback\": {\n            \"uri\": \"https://client.foo\",\n            \"nonce\": \"VJLO6A4CAYLBXHTR0KRO\"\n          }\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`The URI must be reachable from the user's system browser, and can be any `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`https`}</MDXTag>{` URL, an `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`http`}</MDXTag>{` URL for a local-to-the-device host, or a service-specific URI that the user's browser can open. The `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`nonce`}</MDXTag>{` must be a unique value for each transaction and cannot be re-used. The `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`nonce`}</MDXTag>{` value is opaque to the AS and should be random. The client remembers this `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`nonce`}</MDXTag>{` value and associates it with the current user. For a web server or other web application, this is generally done by placing it in the user's session. Native applications are generally considered single-user in nature, so the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`nonce`}</MDXTag>{` value is remembered in the application's current state.`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`When the AS determines that the client's request needs user interaction, it creates a unique interaction URL and returns it to the client in the transaction response. The AS associates this unique URI with the transaction. The interaction URI is for a user-facing page at the AS.`}</MDXTag>\n      <Code from=\"as\" to=\"client\" code={{\n        interaction_url: \"https://server.example.com/interact/4CF492MLVMSW9MKMXKHQ\",\n        server_nonce: \"MBDOFXG4Y5CVJCX821LH\",\n        handle: {\n          value: \"80UPRY5NM33OMUKMKSKU\",\n          type: \"bearer\"\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`Much like the callback URI, the interaction URI must be reachable from the user's system browser, and can be any `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`https`}</MDXTag>{` URL, an `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`http`}</MDXTag>{` URL for a local-to-the-device host, or a service-specific URI that the user's browser can open.`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`The client sends the user to the URL completely as-is, without adding any query parameters, fragments, paths, or other components. If the client is a web server, it can send the user to the remote site via an HTTP redirect.`}</MDXTag>\n      <Code from=\"client\" to=\"browser\" language='http' codeString={`HTTP 302 Found\nLocation: https://server.example.com/interact/4CF492MLVMSW9MKMXKHQ`} />\n      <MDXTag name=\"p\" components={components}>{`If the client is a mobile application, such as an Android app, it can launch the system browser for interaction.`}</MDXTag>\n      <Code from=\"client\" to=\"browser\" language='java' codeString={`Intent browserIntent = \n  new Intent(Intent.ACTION_VIEW, \n    Uri.parse(\"https://server.example.com/interact/4CF492MLVMSW9MKMXKHQ\"));\nstartActivity(browserIntent);`} />\n      <MDXTag name=\"p\" components={components}>{`Obviously, any method including an embedded security tab such as used by the AppAuth implementation of OAuth 2 is also acceptable. The important thing is to get the current user to the AS, where they can start interacting.`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`Once at the AS, the AS can ask the user for authentication, and to authorize the application itself. The AS could prompt the user to provide additional claims or proofs however it sees fit, and this interaction is ultimately outside of the protocol.`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`When the AS has collected whatever input it needs from the user, it sends the user back to the client with an HTTP redirect. First, the AS creates a unique, unguessable interaction handle that the client can use in its subsequent interaction request. The AS also calculates a `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`hash`}</MDXTag>{` to allow the client to confirm the transaction by concatentating the following values with a newline `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`\\n`}</MDXTag>{` character and computing the SHA3_512 hash:`}</MDXTag>\n      <MDXTag name=\"ul\" components={components}>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`nonce`}</MDXTag>{` value sent by the client in the initial transaction request`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`server_nonce`}</MDXTag>{` value returned in the initial transaction response`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`the unique interaction handle`}</MDXTag>\n      </MDXTag>\n      <MDXTag name=\"p\" components={components}>{`The AS creates the URL for the redirect by taking the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`callback`}</MDXTag>{` URI presented in the transaction request and appending two parameters: `}</MDXTag>\n      <MDXTag name=\"ul\" components={components}>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`the Base64 URL encoded `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`hash`}</MDXTag>{` value calculated above`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`a unique interaction handle, in this example `}<MDXTag name=\"inlineCode\" components={components} parentName=\"li\">{`4IFWWIKYBC2PQ6U56NL1`}</MDXTag></MDXTag>\n      </MDXTag>\n      <Code from=\"as\" to=\"browser\" language='http' codeString={`HTTP 302 Found\nLocation: https://client.foo/\n  ?hash=p28jsq0Y2KK3WS__a42tavNC64ldGTBroywsWxT4md_jZQ1R2HZT8BOWYHcLmObM7XHPAdJzTZMtKBsaraJ64A\n  &interact=4IFWWIKYBC2PQ6U56NL1`} />\n      <MDXTag name=\"p\" components={components}>{`Note that the AS has to use a proper URL builder in case the client's callback URL contains existing query parameters, is lacking a root path, or has some other anomaly which would make it problematic to simply concatenate the strings.`}</MDXTag>\n      <MDXTag name=\"blockquote\" components={components}>\n        <MDXTag name=\"p\" components={components} parentName=\"blockquote\">{`This can't be a plain string concatenation because it would potentially let a malicious client inject a bad callback URI that looks safe. Alternatively we could use URI templates but that seems a lot of complexity to enforce with its own set of problems.`}</MDXTag>\n      </MDXTag>\n      <MDXTag name=\"p\" components={components}>{`Once the AS creates the redirect response to the interaction request, the AS deletes or otherwise deactivates the interaction URL to prevent phishing and replay attacks. `}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`If the AS determines that there is an error during the interaction, its response depends on whether or not the incoming interaction URL was valid.`}</MDXTag>\n      <MDXTag name=\"ul\" components={components}>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`If the URL was valid and bound to an active transaction, the AS can return to the client as in a successful transaction. The client needs to send data to the transaction endpoint to determine next steps.`}</MDXTag>\n        <MDXTag name=\"li\" components={components} parentName=\"ul\">{`If the URL was not valid or not bound to an active transaction, the AS can only display to the user an error. Since the client has no way to inject a redirect URI alongside an invalid interaction request, there is reduced risk of open redirection attack.`}</MDXTag>\n      </MDXTag>\n      <MDXTag name=\"p\" components={components}>{`The client receives a request from the user's browser through the callback URL. If the client is a web server, this comes in as any other request. If the client is a native application, it usually receives the full URL from the system in whatever function it has registered to receive incoming requests. In any event, the client needs to parse the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`hash`}</MDXTag>{` parameter and compare its value to a hash calculated by its originally chosen `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`nonce`}</MDXTag>{` value, the server's returned `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`server_nonce`}</MDXTag>{` value from the original transaction request, and the value of the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`interact`}</MDXTag>{` handle parameter from the callback request. If these hash values don't match the client returns an error to the user and stops the transaction. `}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`The client then sends a transaction continue request to the AS including the interaction handle as a parameter. The client also includes the current value of the transaction handle (here as a bearer key) as well as any proofs for keys presented during the transaction start.`}</MDXTag>\n      <MDXTag name=\"blockquote\" components={components}>\n        <MDXTag name=\"p\" components={components} parentName=\"blockquote\">{`Here we've hashed the interaction handle before sending it. It's still in the air whether this hashing is helpful to security or is an unnecessary step.`}</MDXTag>\n      </MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        handle: \"80UPRY5NM33OMUKMKSKU\",\n        interact_handle: \"CuD9MrpSXVKvvI6dN1awtNLx-HhZy46hJFDBicG4KoZaCmBofvqPxtm7CDMTsUFuvcmLwi_zUN70cCvalI6ENw\"\n      }} />\n      <MDXTag name=\"p\" components={components}>{`The AS looks up the transaction from the transaction handle and fetches the interaction handle associated with that transaction. The AS compares the presented handle to hash of the stored interaction handle it appended to the client's callback. If they match, the AS continues processing as normal, likely issuing a token.`}</MDXTag>\n      <MDXTag name=\"h2\" components={components}>{`User Code with Polling`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`The user-code-based interaction is intended for clients that need to have the user use a secondary device of some kind to interact with the authorization server. Unlike the redirect based interaction, the client does not send the user to the AS directly. Instead, the client presents the user with a code and instructs the user to interact with the server. Meanwhile, the client polls the AS in the background until the transaction is approved.`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`The client starts this mode by sending a transaction request indicating that the user will interact with the AS through a secondary device. `}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        \"interact\": {\n          \"user_code\": true\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`When the AS determines that the client's request needs user interaction, it sends an interaction URI in the transaction response. The interaction URI is for a user-facing page at the AS, and this can be a static URI for this mode. The AS also includes a short user-facing code. This code must be random, short-lived, and easily typed by a user. It must be processed in a case-insensitive way, and should use characters that are unambiguous when displayed even at low resolution (e.g., not using both the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`0`}</MDXTag>{` (zero) and `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`O`}</MDXTag>{` (letter O) characters as options).`}</MDXTag>\n      <Code from=\"as\" to=\"client\" code={{\n        user_code: {\n          url: \"https://server.example.com/interact/device\",\n          code: \"A1BC-3DFF\"\n        },\n        handle: {\n          value: \"80UPRY5NM33OMUKMKSKU\",\n          type: \"bearer\"\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`The client presents the user code to the user. The client also indicates to the user that they need to go to the interaction URL. As this is likely to be a static URL, the AS can provide a static link to this page. `}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`Once at the AS, the AS can ask the user for authentication, and to authorize the application itself. The AS could prompt the user to provide additional claims or proofs however it sees fit, and this interaction is ultimately outside of the protocol. At the interaction page, the user is prompted to enter the code from their device. The AS uses this code to look up the associated transaction to determine which actions it needs to take.`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`When the AS has collected whatever additional input it needs from the user, it displays to the user that they can return to their device and continue operation.`}</MDXTag>\n      <MDXTag name=\"blockquote\" components={components}>\n        <MDXTag name=\"p\" components={components} parentName=\"blockquote\">{`To completely close a session-fixation attack, we could require the AS to present another code to the user and have the user enter that into the client device. This only works on some kinds of devices, though, so it would need to be an option. Additionally, we might want to consider a kind of \"secondary application\" based interaction that isn't web-based, such as a CIBA login.`}</MDXTag>\n      </MDXTag>\n      <MDXTag name=\"p\" components={components}>{`Meanwhile, the client can poll the AS using the transaction handle to see if the user has authorized them yet. This request includes proofs of any keys that the client sent during the original transaction request.`}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        handle: \"80UPRY5NM33OMUKMKSKU\"\n      }} />\n      <MDXTag name=\"p\" components={components}>{`If the user has yet to approve the transaction, the AS sends back a response telling the client to wait. This response contains a new transaction handle which replaces the client's original one.`}</MDXTag>\n      <Code from=\"as\" to=\"client\" code={{\n        wait: 30,\n        handle: {\n          value: \"BI9QNW6V9W3XFJK4R02D\",\n          method: \"bearer\"\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`The `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`wait`}</MDXTag>{` parameter tells the client the number of integer seconds it must wait before polling again. The client can continue to poll in this manner until it receives either a token response or the user code times out and the client receives an error response.`}</MDXTag>\n      <MDXTag name=\"h2\" components={components}>{`Redirect with Polling`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`For some kinds of clients, it is possible to show the user a visual signal such as a QR code that the user can scan on a secondary device. This allows the client to send the user to an arbitrary URL but not receive a callback in the front channel, so polling is necessary. `}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        \"interact\": {\n          \"redirect\": true\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`As above, when the AS determines that the client's request needs user interaction, it creates a unique interaction URL and returns it to the client in the transaction response. The AS associates this unique URI with the transaction. The interaction URI is for a user-facing page at the AS. Note that because the client did not send a `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`callback`}</MDXTag>{` to the AS, the AS does not generate or return a `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`server_nonce`}</MDXTag>{` parameter.`}</MDXTag>\n      <Code from=\"as\" to=\"client\" code={{\n        interaction_url: \"https://server.example.com/interact/4CF492MLVMSW9MKMXKHQ\",\n        handle: {\n          value: \"80UPRY5NM33OMUKMKSKU\",\n          type: \"bearer\"\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`The client then communicates this arbitrary URL to the user, perhaps using a QR code. `}</MDXTag>\n      <img src=\"http://api.qrserver.com/v1/create-qr-code/?color=000000&amp;bgcolor=FFFFFF&amp;data=https%3A%2F%2Fserver.example.com%2Finteract%2F4CF492MLVMSW9MKMXKHQ&amp;qzone=1&amp;margin=0&amp;size=200x200&amp;ecc=L\" alt=\"qr code\" />\n      <MDXTag name=\"p\" components={components}>{`While the client waits for the user to complete the interaction, it polls the AS using the transaction handle.`}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        handle: \"80UPRY5NM33OMUKMKSKU\"\n      }} />\n      <MDXTag name=\"p\" components={components}>{`If the user has yet to approve the transaction, the AS sends back a response telling the client to wait. This response contains a new transaction handle which replaces the client's original one.`}</MDXTag>\n      <Code from=\"as\" to=\"client\" code={{\n        wait: 30,\n        handle: {\n          value: \"ZI9QNW6V9W3XFJK4R02D\",\n          method: \"bearer\"\n        }\n      }} />\n      <MDXTag name=\"blockquote\" components={components}>\n        <MDXTag name=\"p\" components={components} parentName=\"blockquote\">{`It would be interesting to figure out if we can combine both the user code and arbitrary redirect URL methods, giving the user a few options. This should be as simple as allowing more flexibility on the interaction request portion and having the server return all possible options.`}</MDXTag>\n      </MDXTag>\n      <MDXTag name=\"h2\" components={components}>{`DIDComm Messages and Queries`}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`Some clients will be able to pass a message from the AS to another piece of software using a secondary protocol, such as DIDComm. `}</MDXTag>\n      <MDXTag name=\"p\" components={components}>{`If the client can pass a complete DIDComm message to the agent, it sends the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`didcomm`}</MDXTag>{` flag. If it can pass along a query, it sends the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`didcomm_query`}</MDXTag>{` flag. `}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        \"interact\": {\n          \"didcomm\": true,\n          \"didcomm_query\": true\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`In either case, the agent might send its response directly to the AS through some external means, or the client might get a message back from the agent. This message is to be included in its transaction continuation request.`}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        handle: \"80UPRY5NM33OMUKMKSKU\",\n        didcomm: {\n          \"...\": \"...\"\n        }\n      }} />\n      <MDXTag name=\"p\" components={components}>{`If the client has no response message from the agent, it can poll the transaction as usual.`}</MDXTag>\n      <Code from=\"client\" to=\"as\" code={{\n        handle: \"80UPRY5NM33OMUKMKSKU\"\n      }} />\n           </MDXTag>;\n  }\n\n}\nexport const _frontmatter = {};\n    "],"sourceRoot":""}