import SEO from '../../components/seo'
import Sequence from '../../components/sequence'

<SEO title="Interaction" keywords={['oauth', 'authorization', 'security']} />


<Sequence code={`
participant alice
participant alice's browser as ab
participant client as c
participant alice's pod as ars
participant alice's as as as
participant bob's pod as brs
 
alice-->c: select pod
c->ars: call API w/no token
ars->as: register resource set "ars"
as->ars: return resource handle "RH1"
ars->c: return transaction endpoint (AS)\\nand resource handle "RH1"
c->c: generate keypair K1
c->c: generate nonce N1
c->as: start transaction with\\n resource: RH1\\n key: K1\\n interact: callback C1, nonce N1\\n user: webid U1
as->as: start transaction X1
as->c: return transaction response with\\n transaction handle TH1\\n interact URI U1
c-->ab: open U1
ab-->as: open U1
as->as: look up transaction X1 from U1
alice-->as: authenticate
alice-->as: authorize X1, includes RH1
as->as: create interaction handle 'IH1'
as-->ab: return to C1\\n with hash(N1, IH1)\\n and IH1
ab-->c: fetch C1
c->as: continue transaction with TH1 and IH1
as->as: find transaction X1 from TH1
as->as: validate IH1 for X1
as->as: delete IH1, TH1
as->as: Create TH2 for X1
as->as: create token AT1 with U1 bound to K1
as->c: return AT1, T2
as->ars: call API with AT1 bound to K1
ars->ars: unpack AT1, find U1
ars->ars: validate AT presentation with K1
c->brs: call API with AT1 bound ot K1
brs->brs: unpack AT1, find U1
 
`} />